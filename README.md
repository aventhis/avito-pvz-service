# avito-pvz-service

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–∞–º–∏ –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤ (–ü–í–ó), –ø—Ä–∏—ë–º–∫–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏. –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –æ—Ç–±–æ—Ä–∞ –Ω–∞ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫—É Go-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤–µ—Å–Ω–æ–π 2025 –≤ –ê–≤–∏—Ç–æ.

---

## üîß –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [`task`](https://taskfile.dev).

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `task`:

```bash
go install github.com/go-task/task/v3/cmd/task@latest
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
go mod tidy
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
go run ./cmd/server
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞ `.env.example`:

```bash
cp .env.example .env
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ docker-compose:

```bash
task docker-up
```

–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker-compose up -d
```

---

## ‚öôÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ OpenAPI

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [`oapi-codegen`](https://github.com/oapi-codegen/oapi-codegen) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

- DTO (—Å—Ç—Ä—É–∫—Ç—É—Ä)
- –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `ServerInterface`
- —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞:

```bash
go install github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen@latest
```

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `task`, –ø–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –≤ —Ä–∞–∑–¥–µ–ª–µ [üõ† Taskfile](#taskfile).

---

> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `api/config.yaml`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî `internal/api/openapi.gen.go`.

---

## Taskfile

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [`task`](https://taskfile.dev).

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

#### ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DTO –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏–∑ OpenAPI —Å—Ö–µ–º—ã:

```bash
task generate-api
```

#### üê≥ Docker –∫–æ–º–∞–Ω–¥—ã:

```bash
task docker-up      # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
task docker-down    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
task docker-logs    # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
task docker-rebuild # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```

#### ‚ÑπÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏:

```bash
task --list
```

> Taskfile –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö: –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ CI.

---

## üåê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è    | –û–ø–∏—Å–∞–Ω–∏–µ                       | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è      |
|---------------|--------------------------------|----------------------|
| DB_HOST       | –•–æ—Å—Ç –ë–î                        | postgres             |
| DB_PORT       | –ü–æ—Ä—Ç –ë–î                        | 5432                 |
| DB_USER       | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î                | postgres             |
| DB_PASSWORD   | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î         | postgres             |
| DB_NAME       | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö                | avito_pvz            |
| DB_SSL_MODE   | –†–µ–∂–∏–º SSL –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î  | disable              |
| APP_ENV       | –û–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è           | development          |
| APP_PORT      | –ü–æ—Ä—Ç HTTP API                  | 8080                 |
| GRPC_PORT     | –ü–æ—Ä—Ç gRPC API                  | 3000                 |
| METRICS_PORT  | –ü–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Prometheus         | 9000                 |

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥ —Å–≤–æ—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
avito-pvz-service/
‚îú‚îÄ‚îÄ api/                  # OpenAPI —Å—Ö–µ–º–∞ –∏ –∫–æ–Ω—Ñ–∏–≥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ swagger.yaml
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ server/           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ HTTP-—Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ deployments/          # –§–∞–π–ª—ã –¥–ª—è –¥–µ–ø–ª–æ—è (CI/CD, Kubernetes –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # DTO –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ oapi-codegen
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db/               # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ grpc/             # gRPC —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/      # Middleware –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ models/           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ repositories/     # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ tests/            # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ Dockerfile            # –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
‚îú‚îÄ‚îÄ .env.example          # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Taskfile.yml          # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ README.md             # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ go.mod / go.sum       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go
‚îî‚îÄ‚îÄ .gitignore
```
